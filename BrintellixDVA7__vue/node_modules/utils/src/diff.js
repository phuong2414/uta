function difference (obj1, obj2) {
  var diff = {}

  for (var prop in obj1) {
    if (obj1.hasOwnProperty(prop)) {
      if (!obj2.hasOwnProperty(prop)) {
        diff[prop] = obj1[prop]
      } else if (isObject(obj1[prop])) {
        var diffObj = difference(obj1[prop], obj2[prop])
        if (Object.keys(diffObj).length) {
          diff[prop] = diffObj
        }
      } else if (obj1[prop] !== obj2[prop]) {
        diff[prop] = obj1[prop]
      }
    }
  }

  return diff
}

// TODO: remove duplication with index.js (solve circular dependencies)
function isObject (obj) {
  return obj && (typeof obj === 'object' || isArray(obj))
}

function isArray (array) {
  return Array.isArray(array)
}

module.exports = difference
