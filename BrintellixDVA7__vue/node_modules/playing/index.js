var rivets = require('rivets'),
	nav = require('nav');

module.exports = {
	bind: function (element) {
		var playingHandler = function () {
			this.view.models[this.keypath] = !element.paused;
		};

		element.addEventListener('play', playingHandler.bind(this));
		element.addEventListener('pause', playingHandler.bind(this));

		nav.onleave(element.pause.bind(element));
	},
	routine: function(element, value){
		var res;

		if(value){
			if(element.paused){
				res = element.play();
			}
		}else{
			res = element.pause();
		}

		//TODO
		if(isPromise(res)){ // Need handle the isue with video and audio. Now play and pause return a Promise.
			res.catch(function(err){ // Temporary solution;
				console.warn('Google Chrome from 50 and higher versions: ', err);
			});
		}
	}
};

function isPromise(result){
	return typeof result === "object";
}