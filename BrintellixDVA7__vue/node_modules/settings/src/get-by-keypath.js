// implementation is copied from npm module 'dot-prop' which is not available for installation via bower

module.exports = function (obj, path, value) {
  if (!isObj(obj) || typeof path !== 'string') {
    return obj
  }

  var pathArr = getPathSegments(path)

  for (var i = 0; i < pathArr.length; i++) {
    if (!Object.prototype.propertyIsEnumerable.call(obj, pathArr[i])) {
      return value
    }

    obj = obj[pathArr[i]]

    if (obj === undefined || obj === null) {
      if (i !== pathArr.length - 1) {
        return value
      }

      break
    }
  }

  return obj
}

function getPathSegments (path) {
  var pathArr = path.split('.')
  var parts = []

  for (var i = 0; i < pathArr.length; i++) {
    var p = pathArr[i]

    while (p[p.length - 1] === '\\' && pathArr[i + 1] !== undefined) {
      p = p.slice(0, -1) + '.'
      p += pathArr[++i]
    }

    parts.push(p)
  }

  return parts
}

function isObj (x) {
  var type = typeof x
  return x !== null && (type === 'object' || type === 'function')
}
